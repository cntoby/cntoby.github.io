<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Cocos2D-X learning 4 | 老白说</title>
  <meta name="author" content="老白">
  
  <meta name="description" content="废话
今天和王爷一起去传说中的车库咖啡见了一个创业团队，跟他们有了一个小时左右的交流时间，交流的详情就不说了，总之，让我和王爷多了一个很好的话题，在回家的路上，我们就这个话题进行了友好、亲切而又愉快的交流，受益匪浅。
不过，最糟心的是，跑这一趟我竟然感冒了，主要是天气热，出了很多汗，而在地铁通道里风太大，晾了汗了，纠结死我了，明天还要去见一个离得比较近的创业团队，我在犹豫到底还要不要去。
概述
今天随便说说在Cocos2D-X开发中，关于对CCSprite方面的优化，总得来说就是尽可能减少渲染次数，这样可以使游戏运行更有效率，能够空出更多的CPU时间做其它的事情，以增加游戏的流畅与体验。
正文
Cocos2D为图片资源批量加载提供了CCSpriteFrameCache类，此类可以通过使用Sprite Sheet文件来减少图片加载次数，简单来说，就是把多个图片拼成一个大图片，之后通过坐标在大文件上取到相应的图片，这个技术被广泛使用在网页设计及游戏开发中。在这里我使用了一个叫做Zwoptex的软件自动生成大图片及相应的.plist，软件的具体使用方法就不在这里细说了（另外，朋友介绍说Texture Packer是可以更好的做这件事的工具，改天尝试一下）。
另外，Cocos2D还提供了一个CCSpriteBatchNode类，这个类主要作用是，当相同图片资源被重复使用时，通过这个类可以减少使相同的图片只渲染一次，具体做法看下面的代码。
PS: 代码基于上一篇BLOG，只对关键部分进行说明。
GameSceneDH.h1234567891011121314#ifndef __StudyCocos2D__GameSceneDH__#define __StudyCocos2D__GameSceneDH__#include &amp;lt;iostream&amp;gt;#include &#34;cocos2d.h&#34;using namespace cocos2d;class GameSceneDH: public CCLayer &amp;#123;public:    static CCScene *scene();    virtual bool init();    CREATE_FUNC(GameSceneDH);&amp;#125;;">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Cocos2D-X learning 4"/>
  <meta property="og:site_name" content="老白说"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="老白说" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-36519147-1', 'auto');
	ga('send', 'pageview');

</script>


</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">老白说</a></h1>
  <h2><a href="/">讲述老白身边的故事</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-03-29T15:22:08.000Z"><a href="/2014/03/29/cocos2d-x-learning-4/">2014-03-29</a></time>
      
      
  
    <h1 class="title">Cocos2D-X learning 4</h1>
  

    </header>
    <div class="entry">
      
        <h3>废话</h3>
<p>今天和王爷一起去传说中的车库咖啡见了一个创业团队，跟他们有了一个小时左右的交流时间，交流的详情就不说了，总之，让我和王爷多了一个很好的话题，在回家的路上，我们就这个话题进行了友好、亲切而又愉快的交流，受益匪浅。<br>
不过，最糟心的是，跑这一趟我竟然感冒了，主要是天气热，出了很多汗，而在地铁通道里风太大，晾了汗了，纠结死我了，明天还要去见一个离得比较近的创业团队，我在犹豫到底还要不要去。</p>
<h3>概述</h3>
<p>今天随便说说在Cocos2D-X开发中，关于对CCSprite方面的优化，总得来说就是尽可能减少渲染次数，这样可以使游戏运行更有效率，能够空出更多的CPU时间做其它的事情，以增加游戏的流畅与体验。</p>
<h3>正文</h3>
<p>Cocos2D为图片资源批量加载提供了<code>CCSpriteFrameCache</code>类，此类可以通过使用Sprite Sheet文件来减少图片加载次数，简单来说，就是把多个图片拼成一个大图片，之后通过坐标在大文件上取到相应的图片，这个技术被广泛使用在网页设计及游戏开发中。在这里我使用了一个叫做Zwoptex的软件自动生成大图片及相应的<code>.plist</code>，软件的具体使用方法就不在这里细说了（另外，朋友介绍说Texture Packer是可以更好的做这件事的工具，改天尝试一下）。</p>
<p>另外，Cocos2D还提供了一个<code>CCSpriteBatchNode</code>类，这个类主要作用是，当相同图片资源被重复使用时，通过这个类可以减少使相同的图片只渲染一次，具体做法看下面的代码。<br>
PS: 代码基于上一篇BLOG，只对关键部分进行说明。</p>
<figure class="highlight c++"><figcaption><span>GameSceneDH.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __StudyCocos2D__GameSceneDH__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __StudyCocos2D__GameSceneDH__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"cocos2d.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cocos2d;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameSceneDH</span>:</span> <span class="keyword">public</span> CCLayer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> CCScene *<span class="title">scene</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line">    CREATE_FUNC(GameSceneDH);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<figure class="highlight c++"><figcaption><span>GameSceneDH.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  GameSceneDH.cpp</span></span><br><span class="line"><span class="comment">//  StudyCocos2D</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Toby Lee on 14-3-30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"GameSceneDH.h"</span></span></span><br><span class="line">CCScene * GameSceneDH::scene()</span><br><span class="line">&#123;</span><br><span class="line">    CCScene *scene = CCScene::create();</span><br><span class="line">    CCLayer *layer = GameSceneDH::create();</span><br><span class="line">    scene-&gt;addChild(layer);</span><br><span class="line">    <span class="keyword">return</span> scene;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> GameSceneDH::init()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!CCLayer::init()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CCSize winSize = CCDirector::sharedDirector()-&gt;getWinSize();</span><br><span class="line">    </span><br><span class="line">    CCSprite *background = CCSprite::create(<span class="string">"大唐边境.jpg"</span>);</span><br><span class="line">    CCSize backgroundSize = background-&gt;getContentSize();</span><br><span class="line">    background-&gt;setScale(winSize.width / backgroundSize.width);</span><br><span class="line">    background-&gt;setPosition(ccp(winSize.width/<span class="number">2</span>, winSize.height/<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(background);</span><br><span class="line">    </span><br><span class="line">    CCSpriteFrameCache *frameCache = CCSpriteFrameCache::sharedSpriteFrameCache();</span><br><span class="line">    frameCache-&gt;addSpriteFramesWithFile(<span class="string">"DH.plist"</span>);</span><br><span class="line">    </span><br><span class="line">    CCSpriteFrame *frameDH0, *frameDH1, *frameDH2, *frameDH3, *frameDH4, *frameDH5;</span><br><span class="line">    frameDH0 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (0).png"</span>);</span><br><span class="line">    frameDH1 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (1).png"</span>);</span><br><span class="line">    frameDH2 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (2).png"</span>);</span><br><span class="line">    frameDH3 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (3).png"</span>);</span><br><span class="line">    frameDH4 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (4).png"</span>);</span><br><span class="line">    frameDH5 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (5).png"</span>);</span><br><span class="line">    </span><br><span class="line">    frameDH0-&gt;autorelease();</span><br><span class="line">    frameDH1-&gt;autorelease();</span><br><span class="line">    frameDH2-&gt;autorelease();</span><br><span class="line">    frameDH3-&gt;autorelease();</span><br><span class="line">    frameDH4-&gt;autorelease();</span><br><span class="line">    frameDH5-&gt;autorelease();</span><br><span class="line">    </span><br><span class="line">    CCSprite *sp0 = CCSprite::createWithSpriteFrame(frameDH0);</span><br><span class="line">    sp0-&gt;setPosition(ccp(<span class="number">50</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp0);</span><br><span class="line">    CCSprite *sp1 = CCSprite::createWithSpriteFrame(frameDH1);</span><br><span class="line">    sp1-&gt;setPosition(ccp(<span class="number">140</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp1);</span><br><span class="line">    CCSprite *sp2 = CCSprite::createWithSpriteFrame(frameDH2);</span><br><span class="line">    sp2-&gt;setPosition(ccp(<span class="number">230</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp2);</span><br><span class="line">    CCSprite *sp3 = CCSprite::createWithSpriteFrame(frameDH3);</span><br><span class="line">    sp3-&gt;setPosition(ccp(<span class="number">320</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp3);</span><br><span class="line">    CCSprite *sp4 = CCSprite::createWithSpriteFrame(frameDH4);</span><br><span class="line">    sp4-&gt;setPosition(ccp(<span class="number">410</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp4);</span><br><span class="line">    CCSprite *sp5 = CCSprite::createWithSpriteFrame(frameDH5);</span><br><span class="line">    sp5-&gt;setPosition(ccp(<span class="number">500</span>, <span class="number">150</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(sp5);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码中，第25-29行为游戏添加了背景，这个不在本文的写作目的之中，其中27、28行是将背景的大小和位置调整到铺满整个窗口。<br>
第31、32行利用<code>.plist</code>文件初始化了一个SpriteSheet图片，<code>CCSpriteFrameCache</code>类全局有效以单例的形式使用，但是为了方便后面使用，这里单独声明了一个<code>CCSpriteFrameCache</code>对象。<br>
从34行开始到第40行，声明一组<code>CCSpriteFrame</code>对象，并通过文件名在<code>CCSpriteFrameCache</code>类中初始化。从49行到66行，通过已经创建的``CCSpriteFrame<code>对象创建一些相应的</code>CCSprite`实例，并做位置做相应的调整后加入到场景中。<br>
在这里为了便于说明，尽可能少的牵涉到无关内容，对代码本身并没做优化。<br>
<img src="/images/cocos2d-x-learning-4/before.png" alt="进行CCSpriteBatchNode优化前"><br>
注意看界面左下角的帧率信息。</p>
<p>下面，我们在代码中通过<code>CCSpriteBatchNode</code>对程序进行优化，代码如下：</p>
<figure class="highlight cpp"><figcaption><span>GameSceneDH.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  GameSceneDH.cpp</span></span><br><span class="line"><span class="comment">//  StudyCocos2D</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by Toby Lee on 14-3-30.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"GameSceneDH.h"</span></span></span><br><span class="line">CCScene * GameSceneDH::scene()</span><br><span class="line">&#123;</span><br><span class="line">    CCScene *scene = CCScene::create();</span><br><span class="line">    CCLayer *layer = GameSceneDH::create();</span><br><span class="line">    scene-&gt;addChild(layer);</span><br><span class="line">    <span class="keyword">return</span> scene;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> GameSceneDH::init()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!CCLayer::init()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    CCSize winSize = CCDirector::sharedDirector()-&gt;getWinSize();</span><br><span class="line">    </span><br><span class="line">    CCSprite *background = CCSprite::create(<span class="string">"大唐边境.jpg"</span>);</span><br><span class="line">    CCSize backgroundSize = background-&gt;getContentSize();</span><br><span class="line">    background-&gt;setScale(winSize.width / backgroundSize.width);</span><br><span class="line">    background-&gt;setPosition(ccp(winSize.width/<span class="number">2</span>, winSize.height/<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(background);</span><br><span class="line">    </span><br><span class="line">    CCSpriteFrameCache *frameCache = CCSpriteFrameCache::sharedSpriteFrameCache();</span><br><span class="line">    frameCache-&gt;addSpriteFramesWithFile(<span class="string">"DH.plist"</span>);</span><br><span class="line">    CCSpriteBatchNode *batchNode = CCSpriteBatchNode::create(<span class="string">"DH.png"</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;addChild(batchNode);</span><br><span class="line">    </span><br><span class="line">    CCSpriteFrame *frameDH0, *frameDH1, *frameDH2, *frameDH3, *frameDH4, *frameDH5;</span><br><span class="line">    frameDH0 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (0).png"</span>);</span><br><span class="line">    frameDH1 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (1).png"</span>);</span><br><span class="line">    frameDH2 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (2).png"</span>);</span><br><span class="line">    frameDH3 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (3).png"</span>);</span><br><span class="line">    frameDH4 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (4).png"</span>);</span><br><span class="line">    frameDH5 = frameCache-&gt;spriteFrameByName(<span class="string">"DH (5).png"</span>);</span><br><span class="line">    </span><br><span class="line">    frameDH0-&gt;autorelease();</span><br><span class="line">    frameDH1-&gt;autorelease();</span><br><span class="line">    frameDH2-&gt;autorelease();</span><br><span class="line">    frameDH3-&gt;autorelease();</span><br><span class="line">    frameDH4-&gt;autorelease();</span><br><span class="line">    frameDH5-&gt;autorelease();</span><br><span class="line">    </span><br><span class="line">    CCSprite *sp0 = CCSprite::createWithSpriteFrame(frameDH0);</span><br><span class="line">    sp0-&gt;setPosition(ccp(<span class="number">50</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp0);</span><br><span class="line">    CCSprite *sp1 = CCSprite::createWithSpriteFrame(frameDH1);</span><br><span class="line">    sp1-&gt;setPosition(ccp(<span class="number">140</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp1);</span><br><span class="line">    CCSprite *sp2 = CCSprite::createWithSpriteFrame(frameDH2);</span><br><span class="line">    sp2-&gt;setPosition(ccp(<span class="number">230</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp2);</span><br><span class="line">    CCSprite *sp3 = CCSprite::createWithSpriteFrame(frameDH3);</span><br><span class="line">    sp3-&gt;setPosition(ccp(<span class="number">320</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp3);</span><br><span class="line">    CCSprite *sp4 = CCSprite::createWithSpriteFrame(frameDH4);</span><br><span class="line">    sp4-&gt;setPosition(ccp(<span class="number">410</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp4);</span><br><span class="line">    CCSprite *sp5 = CCSprite::createWithSpriteFrame(frameDH5);</span><br><span class="line">    sp5-&gt;setPosition(ccp(<span class="number">500</span>, <span class="number">150</span>));</span><br><span class="line">    batchNode-&gt;addChild(sp5);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中，第33-34行，创建了一个<code>CCSpriteBatchNode</code>对象，并将其加入场景，在51-68行中，所有的<code>CCSprite</code>对象全部加入到<code>CCSpriteBatchNode</code>对象，此时，所有的<code>CCSprite</code>将不再重新渲染，如下图：<br>
<img src="/images/cocos2d-x-learning-4/after.png" alt="经过CCSpriteBatchNode优化后"><br>
与之前的截图相比，渲染次数减少到2，说明这样的优化方法是可行的。</p>
<p>说明：<code>CCSprite</code>对象必须加入到<code>CCSpriteBatchNode</code>中才能起到优化作用，如果直接将<code>CCSprite</code>加入到场景中，则不会重用<code>CCSpriteBatchNode</code>的渲染结果。这里可以理解为，<code>CCSpriteBatchNode</code>是一个虚拟的容器，将此容器加入到场景后，再将<code>CCSprite</code>加入其中，由<code>CCSpriteBatchNode</code>对其进行管理，另外，如果<code>CCSprite</code>使用的资源不包含在<code>CCSpriteBatchNode</code>初始化的资源中，则程序会出现异常。</p>
<h3>结束</h3>
<p>程序的优化方法有很多种，但是并不是所有的优化方法都适用于当前的应用场景 ，这也牵涉到优化的性价比的问题，对程序进行适度的优化才是最正确的。</p>
<p>另：由于本人是初学跟前端有关的开发，特别是游戏前端，因此，在我所讨论的内容中难免有所偏颇，希望能够得到大家的指正，谢谢。</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Cocos2D/">Cocos2D</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/game/">game</a>, <a href="/tags/TexturePacker/">TexturePacker</a>, <a href="/tags/zwoptex/">zwoptex</a>, <a href="/tags/cocos2d-x/">cocos2d-x</a>, <a href="/tags/cocos2d/">cocos2d</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
<script>
 (function() {
     var d = document, s = d.createElement('script');
     s.src = 'https://cntoby.disqus.com/embed.js';
     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<script id="dsq-count-scr" src="//cntoby.disqus.com/count.js" async></script>
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:www.tobycn.org">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/Cocos2D/">Cocos2D</a><small>4</small></li>
  
    <li><a href="/categories/Game/">Game</a><small>1</small></li>
  
    <li><a href="/categories/Git/">Git</a><small>1</small></li>
  
    <li><a href="/categories/Reading/">Reading</a><small>1</small></li>
  
    <li><a href="/categories/Story/">Story</a><small>0</small></li>
  
    <li><a href="/categories/server/archlinux/">archlinux</a><small>1</small></li>
  
    <li><a href="/categories/coffee/">coffee</a><small>1</small></li>
  
    <li><a href="/categories/emacs/">emacs</a><small>1</small></li>
  
    <li><a href="/categories/functionally/emacs/">emacs</a><small>1</small></li>
  
    <li><a href="/categories/functionally/">functionally</a><small>1</small></li>
  
    <li><a href="/categories/haskell/">haskell</a><small>4</small></li>
  
    <li><a href="/categories/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/categories/mysql/network/">network</a><small>1</small></li>
  
    <li><a href="/categories/server/">server</a><small>1</small></li>
  
    <li><a href="/categories/技术生涯/">技术生涯</a><small>1</small></li>
  
    <li><a href="/categories/日常生活/">日常生活</a><small>4</small></li>
  
    <li><a href="/categories/架构/">架构</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Story/">Story</a><small>0</small></li>
  
    <li><a href="/tags/TexturePacker/">TexturePacker</a><small>3</small></li>
  
    <li><a href="/tags/boot/">boot</a><small>1</small></li>
  
    <li><a href="/tags/c/">c</a><small>1</small></li>
  
    <li><a href="/tags/cheater/">cheater</a><small>1</small></li>
  
    <li><a href="/tags/cocos2d/">cocos2d</a><small>4</small></li>
  
    <li><a href="/tags/cocos2d-x/">cocos2d-x</a><small>4</small></li>
  
    <li><a href="/tags/coffee/">coffee</a><small>1</small></li>
  
    <li><a href="/tags/elisp/">elisp</a><small>2</small></li>
  
    <li><a href="/tags/emacs/">emacs</a><small>2</small></li>
  
    <li><a href="/tags/faker/">faker</a><small>1</small></li>
  
    <li><a href="/tags/functionally/">functionally</a><small>6</small></li>
  
    <li><a href="/tags/game/">game</a><small>5</small></li>
  
    <li><a href="/tags/gen8/">gen8</a><small>1</small></li>
  
    <li><a href="/tags/git/">git</a><small>1</small></li>
  
    <li><a href="/tags/gitolite/">gitolite</a><small>1</small></li>
  
    <li><a href="/tags/haskell/">haskell</a><small>4</small></li>
  
    <li><a href="/tags/hhkb/">hhkb</a><small>1</small></li>
  
    <li><a href="/tags/linux/">linux</a><small>1</small></li>
  
    <li><a href="/tags/lisp/">lisp</a><small>3</small></li>
  
    <li><a href="/tags/memory/">memory</a><small>0</small></li>
  
    <li><a href="/tags/mysql/">mysql</a><small>1</small></li>
  
    <li><a href="/tags/mysql-packet/">mysql packet</a><small>1</small></li>
  
    <li><a href="/tags/network/">network</a><small>1</small></li>
  
    <li><a href="/tags/programming/">programming</a><small>1</small></li>
  
    <li><a href="/tags/range/">range</a><small>1</small></li>
  
    <li><a href="/tags/sprite-sheet/">sprite sheet</a><small>1</small></li>
  
    <li><a href="/tags/ssh/">ssh</a><small>1</small></li>
  
    <li><a href="/tags/swindlers/">swindlers</a><small>1</small></li>
  
    <li><a href="/tags/tuple/">tuple</a><small>1</small></li>
  
    <li><a href="/tags/web/">web</a><small>2</small></li>
  
    <li><a href="/tags/zwoptex/">zwoptex</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2018 老白
  
</div>
<div class="clearfix"></div></footer>
  <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
